# Улучшения UX валидации при создании нод

## Изменения

### 1. Замена `alert()` на `ConfirmProvider`

**Было:**
- Использовался стандартный браузерный `alert()` при попытке создать ноду с существующими ошибками валидации
- Плохой UX - нативный alert блокирует весь UI браузера

**Стало:**
- Используется кастомный `ConfirmProvider` с красивым диалоговым окном
- Диалог показывает:
  - Заголовок: "Невозможно создать новую ноду"
  - Описание с количеством невалидных нод
  - Список всех нод с ошибками (нумерованный)
  - Две кнопки:
    - "Перейти к первой ошибке" (primary)
    - "Отмена" (secondary)

### 2. Автоматическая фокусировка на первую невалидную ноду

При нажатии на кнопку "Перейти к первой ошибке":
- Камера автоматически перемещается к первой невалидной ноде
- Нода выделяется (selected)
- Используется плавная анимация (fitView с duration 800ms)

### 3. Улучшенное форматирование ошибок

**Формат вывода:**
```
Сначала заполните данные в существующих нодах (2):

1. "Delay Step" (Delay):
   Необходимо указать время задержки

2. "System Action" (ActivitySystem):
   Необходимо указать системное действие
```

### 4. Поддержка переносов строк в ConfirmDialog

Добавлены CSS стили для корректного отображения многострочного текста:
```css
.desc {
    white-space: pre-wrap; /* Сохраняет переносы строк */
    max-height: 400px;
    overflow-y: auto; /* Скролл при большом количестве ошибок */
}
```

## Файлы изменены

### `NewNodesPanel.tsx`
- Добавлен импорт `useConfirm` и `focusOnInvalidNode`
- Функция `startCreateNode` стала `async`
- Заменен `alert()` на `await confirm()`
- Добавлена логика фокусировки на первую ошибку

### `ConfirmDialog.module.css`
- Добавлен `white-space: pre-wrap` для поддержки переносов строк
- Добавлен `max-height` и `overflow-y` для больших списков ошибок

## Технические детали

### Использование в коде

```typescript
const confirm = useConfirm();

// В обработчике события
if (validation.hasInvalidNodes) {
    const shouldFocus = await confirm({
        title: 'Невозможно создать новую ноду',
        description: `Список ошибок:\n\n${errorsList}`,
        confirmText: 'Перейти к первой ошибке',
        cancelText: 'Отмена',
        danger: false,
    });

    if (shouldFocus) {
        focusOnInvalidNode(rf, validation.invalidNodes[0].nodeId);
    }

    return;
}
```

### Обработка множественных ошибок

- Система корректно отображает список ВСЕХ невалидных нод
- При фокусировке переходит к ПЕРВОЙ ноде из списка
- Пользователь видит полную картину всех проблем валидации

## Преимущества

1. ✅ **Лучший UX** - красивый диалог вместо нативного alert
2. ✅ **Информативность** - показывает все ошибки сразу
3. ✅ **Навигация** - кнопка для перехода к проблемной ноде
4. ✅ **Консистентность** - использует ту же систему, что и при сохранении
5. ✅ **Масштабируемость** - поддерживает любое количество ошибок с прокруткой

## Как протестировать

1. Создать ноду с пустыми обязательными полями (например, DelayStep без timeSpan)
2. Попытаться создать еще одну ноду
3. Должно появиться диалоговое окно с описанием ошибки
4. Нажать "Перейти к первой ошибке"
5. Камера должна переместиться к невалидной ноде
6. Нода должна быть выделена (selected)
